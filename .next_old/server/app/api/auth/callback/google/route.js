"use strict";(()=>{var e={};e.id=689,e.ids=[689],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},18569:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>w,patchFetch:()=>f,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var a={};r.r(a),r.d(a,{GET:()=>l});var s=r(49303),n=r(88716),o=r(60670),i=r(87070),c=r(71615),u=r(47916),d=r(49001);async function l(e){let t=e.nextUrl,r=t.origin,a=t.searchParams.get("code"),s=t.searchParams.get("state"),n=t.searchParams.get("error"),o=await (0,c.cookies)(),l=o.get("oauth_state_google")?.value,p=o.get("oauth_next")?.value||"/app/editor";if(n)return i.NextResponse.redirect(`${r}/auth/login?error=${encodeURIComponent(n)}`);if(!a||!s)return i.NextResponse.redirect(`${r}/auth/login?error=missing_code_state`);if(!l||s!==l)return i.NextResponse.redirect(`${r}/auth/login?error=invalid_state`);let m=process.env.GOOGLE_CLIENT_ID,h=process.env.GOOGLE_CLIENT_SECRET,g=`${r}/api/auth/callback/google`;if(!m||!h)return i.NextResponse.redirect(`${r}/auth/login?error=oauth_not_configured`);try{let e=new URLSearchParams({code:a,client_id:m,client_secret:h,redirect_uri:g,grant_type:"authorization_code"}),t=await fetch("https://oauth2.googleapis.com/token",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:e});if(!t.ok)return await t.json(),i.NextResponse.redirect(`${r}/auth/login?error=token_exchange_failed`);let s=await t.json();if(!s.access_token)return i.NextResponse.redirect(`${r}/auth/login?error=missing_access_token`);let n=await fetch("https://www.googleapis.com/oauth2/v2/userinfo",{headers:{Authorization:`Bearer ${s.access_token}`}});if(!n.ok)return await n.json(),i.NextResponse.redirect(`${r}/auth/login?error=userinfo_failed`);let o=await n.json();if(!o.email)return i.NextResponse.redirect(`${r}/auth/login?error=missing_email`);let c=await (0,d.qk)({email:o.email,name:o.name||o.given_name,image:o.picture,provider:"google",providerAccountId:o.sub,access_token:s.access_token,refresh_token:s.refresh_token}),l=new Date(Date.now()+6048e5),w=crypto.randomUUID(),f=await (0,d.ed)({userId:c.id,sessionToken:w,expires:l}),_=await (0,u.kt)({userId:c.id,email:c.email,sessionId:f.id}),v=i.NextResponse.redirect(`${r}${p}`);return v.cookies.set("omni_session",_,{httpOnly:!0,sameSite:"lax",secure:!0,path:"/",maxAge:604800}),v.cookies.set("oauth_state_google","",{path:"/",maxAge:0}),v.cookies.set("oauth_next","",{path:"/",maxAge:0}),v}catch(e){return i.NextResponse.redirect(`${r}/auth/login?error=oauth_error`)}}let p=new s.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/callback/google/route",pathname:"/api/auth/callback/google",filename:"route",bundlePath:"app/api/auth/callback/google/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\omnivid\\frontend\\app\\api\\auth\\callback\\google\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:m,staticGenerationAsyncStorage:h,serverHooks:g}=p,w="/api/auth/callback/google/route";function f(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},49001:(e,t,r)=>{r.d(t,{I$:()=>c,ed:()=>m,r4:()=>i,SO:()=>h,QF:()=>p,qk:()=>f,Le:()=>g,GY:()=>o,tj:()=>d,Bi:()=>w,Zy:()=>l});let a=require("@prisma/client"),s=global.prisma||new a.PrismaClient;async function n(e){return s.user.findUnique({where:{email:e}})}async function o(e){return s.user.findUnique({where:{email:e},include:{accounts:!0}})}async function i(e){return s.user.create({data:e})}async function c(e){let t=crypto.randomUUID(),r=new Date(Date.now()+36e5);return await s.passwordResetToken.create({data:{userId:e,token:t,expires:r,used:!1}})}async function u(e,t,r,a,n){await s.account.upsert({where:{provider_providerAccountId:{provider:t,providerAccountId:r}},update:{access_token:a,refresh_token:n,updatedAt:new Date},create:{userId:e,type:"oauth",provider:t,providerAccountId:r,access_token:a,refresh_token:n}})}async function d(e){return s.user.findUnique({where:{id:e},include:{accounts:!0}})}async function l(e,t){return s.user.update({where:{id:e},data:{password:t}})}async function p(e){return s.session.deleteMany({where:{userId:e}})}async function m(e){return s.session.create({data:e})}async function h(e){return s.session.delete({where:{sessionToken:e}})}async function g(e){return s.passwordResetToken.findUnique({where:{token:e},include:{user:!0}})}async function w(e){return s.passwordResetToken.update({where:{id:e},data:{used:!0}})}async function f(e){let t=await s.account.findUnique({where:{provider_providerAccountId:{provider:e.provider,providerAccountId:e.providerAccountId}},include:{user:!0}});if(t)return t.user;let r=await n(e.email);return r?(await u(r.id,e.provider,e.providerAccountId,e.access_token,e.refresh_token),r):await s.user.create({data:{email:e.email,name:e.name,image:e.image,emailVerified:!0,accounts:{create:{type:"oauth",provider:e.provider,providerAccountId:e.providerAccountId,access_token:e.access_token,refresh_token:e.refresh_token}}}})}},47916:(e,t,r)=>{r.d(t,{GI:()=>m,Gv:()=>l,Rf:()=>f,Uj:()=>g,cC:()=>w,c_:()=>d,kt:()=>h,vV:()=>p});var a=r(86890),s=r(41463),n=r(71615),o=r(21067),i=r(98691);let c=process.env.JWT_SECRET,u=new TextEncoder().encode(c);async function d(e){return await (0,i.vp)(e,12)}async function l(e,t){return await (0,i.qu)(e,t)}function p(e){return o.Z_().email().safeParse(e).success}function m(e){let t=/[a-z]/.test(e),r=/[A-Z]/.test(e),a=/\d/.test(e),s=/[^A-Za-z0-9]/.test(e);return e.length<8?{valid:!1,message:"Password must be at least 8 characters"}:t&&r?a?s?{valid:!0}:{valid:!1,message:"Password must include at least one special character"}:{valid:!1,message:"Password must include at least one number"}:{valid:!1,message:"Password must include both upper and lower case letters"}}async function h(e){return await new a.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(u)}async function g(e){(0,n.cookies)().set("omni_session",e,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800})}async function w(){let e=n.cookies().get("omni_session")?.value;if(!e)return null;try{let{payload:t}=await (0,s._)(e,u,{algorithms:["HS256"]});return t}catch{return null}}function f(){(0,n.cookies)().delete("omni_session")}o.Ry({email:o.Z_().email("Invalid email address"),password:o.Z_().min(6,"Password must be at least 6 characters")}),o.Ry({name:o.Z_().min(2,"Name must be at least 2 characters"),email:o.Z_().email("Invalid email address"),password:o.Z_().min(6,"Password must be at least 6 characters")}),o.Ry({email:o.Z_().email("Invalid email address")}),o.Ry({password:o.Z_().min(6,"Password must be at least 6 characters"),confirmPassword:o.Z_()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]})}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,627],()=>r(18569));module.exports=a})();