"use strict";(()=>{var e={};e.id=873,e.ids=[873],e.modules={72934:e=>{e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},72373:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>f,patchFetch:()=>h,requestAsyncStorage:()=>p,routeModule:()=>l,serverHooks:()=>w,staticGenerationAsyncStorage:()=>m});var a={};s.r(a),s.d(a,{POST:()=>d});var r=s(49303),n=s(88716),i=s(60670),o=s(87070),u=s(47916),c=s(49001);async function d(e){try{let{email:t,password:s}=await e.json()||{};if(!t||!s)return o.NextResponse.json({message:"Email and password are required"},{status:400});if(!(0,u.vV)(t))return o.NextResponse.json({message:"Invalid email address"},{status:400});let a=await (0,c.GY)(t);if(!a||!a.password||!await (0,u.Gv)(s,a.password))return o.NextResponse.json({message:"Invalid email or password"},{status:401});let r=new Date(Date.now()+6048e5),n=crypto.randomUUID(),i=await (0,c.ed)({userId:a.id,sessionToken:n,expires:r}),d=await (0,u.kt)({userId:a.id,email:a.email,sessionId:i.id});return await (0,u.Uj)(d),o.NextResponse.json({ok:!0,message:"Logged in successfully",user:{id:a.id,email:a.email,name:a.name,image:a.image}})}catch(e){return o.NextResponse.json({message:"An error occurred during login"},{status:500})}}let l=new r.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/login/route",pathname:"/api/auth/login",filename:"route",bundlePath:"app/api/auth/login/route"},resolvedPagePath:"C:\\Users\\HP\\Desktop\\omnivid\\frontend\\app\\api\\auth\\login\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:w}=l,f="/api/auth/login/route";function h(){return(0,i.patchFetch)({serverHooks:w,staticGenerationAsyncStorage:m})}},49001:(e,t,s)=>{s.d(t,{I$:()=>u,ed:()=>m,r4:()=>o,SO:()=>w,QF:()=>p,qk:()=>v,Le:()=>f,GY:()=>i,tj:()=>d,Bi:()=>h,Zy:()=>l});let a=require("@prisma/client"),r=global.prisma||new a.PrismaClient;async function n(e){return r.user.findUnique({where:{email:e}})}async function i(e){return r.user.findUnique({where:{email:e},include:{accounts:!0}})}async function o(e){return r.user.create({data:e})}async function u(e){let t=crypto.randomUUID(),s=new Date(Date.now()+36e5);return await r.passwordResetToken.create({data:{userId:e,token:t,expires:s,used:!1}})}async function c(e,t,s,a,n){await r.account.upsert({where:{provider_providerAccountId:{provider:t,providerAccountId:s}},update:{access_token:a,refresh_token:n,updatedAt:new Date},create:{userId:e,type:"oauth",provider:t,providerAccountId:s,access_token:a,refresh_token:n}})}async function d(e){return r.user.findUnique({where:{id:e},include:{accounts:!0}})}async function l(e,t){return r.user.update({where:{id:e},data:{password:t}})}async function p(e){return r.session.deleteMany({where:{userId:e}})}async function m(e){return r.session.create({data:e})}async function w(e){return r.session.delete({where:{sessionToken:e}})}async function f(e){return r.passwordResetToken.findUnique({where:{token:e},include:{user:!0}})}async function h(e){return r.passwordResetToken.update({where:{id:e},data:{used:!0}})}async function v(e){let t=await r.account.findUnique({where:{provider_providerAccountId:{provider:e.provider,providerAccountId:e.providerAccountId}},include:{user:!0}});if(t)return t.user;let s=await n(e.email);return s?(await c(s.id,e.provider,e.providerAccountId,e.access_token,e.refresh_token),s):await r.user.create({data:{email:e.email,name:e.name,image:e.image,emailVerified:!0,accounts:{create:{type:"oauth",provider:e.provider,providerAccountId:e.providerAccountId,access_token:e.access_token,refresh_token:e.refresh_token}}}})}},47916:(e,t,s)=>{s.d(t,{GI:()=>m,Gv:()=>l,Rf:()=>v,Uj:()=>f,cC:()=>h,c_:()=>d,kt:()=>w,vV:()=>p});var a=s(86890),r=s(41463),n=s(71615),i=s(21067),o=s(98691);let u=process.env.JWT_SECRET,c=new TextEncoder().encode(u);async function d(e){return await (0,o.vp)(e,12)}async function l(e,t){return await (0,o.qu)(e,t)}function p(e){return i.Z_().email().safeParse(e).success}function m(e){let t=/[a-z]/.test(e),s=/[A-Z]/.test(e),a=/\d/.test(e),r=/[^A-Za-z0-9]/.test(e);return e.length<8?{valid:!1,message:"Password must be at least 8 characters"}:t&&s?a?r?{valid:!0}:{valid:!1,message:"Password must include at least one special character"}:{valid:!1,message:"Password must include at least one number"}:{valid:!1,message:"Password must include both upper and lower case letters"}}async function w(e){return await new a.N(e).setProtectedHeader({alg:"HS256"}).setIssuedAt().setExpirationTime("7d").sign(c)}async function f(e){(0,n.cookies)().set("omni_session",e,{httpOnly:!0,secure:!0,sameSite:"lax",path:"/",maxAge:604800})}async function h(){let e=n.cookies().get("omni_session")?.value;if(!e)return null;try{let{payload:t}=await (0,r._)(e,c,{algorithms:["HS256"]});return t}catch{return null}}function v(){(0,n.cookies)().delete("omni_session")}i.Ry({email:i.Z_().email("Invalid email address"),password:i.Z_().min(6,"Password must be at least 6 characters")}),i.Ry({name:i.Z_().min(2,"Name must be at least 2 characters"),email:i.Z_().email("Invalid email address"),password:i.Z_().min(6,"Password must be at least 6 characters")}),i.Ry({email:i.Z_().email("Invalid email address")}),i.Ry({password:i.Z_().min(6,"Password must be at least 6 characters"),confirmPassword:i.Z_()}).refine(e=>e.password===e.confirmPassword,{message:"Passwords don't match",path:["confirmPassword"]})}};var t=require("../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),a=t.X(0,[276,972,627],()=>s(72373));module.exports=a})();